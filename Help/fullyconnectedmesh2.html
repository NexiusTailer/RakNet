<HTML>
<HEAD>

<TITLE>Fully Connected Mesh 2</TITLE>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</HEAD>
<link href="RaknetManual.css" rel="stylesheet" type="text/css">
<meta name="title" content="RakNet - Advanced multiplayer game networking API">
</HEAD>
<BODY BGCOLOR="#ffffff" LINK="#003399" vlink="#003399" alink="#003399" LEFTMARGIN="0" TOPMARGIN="0" MARGINWIDTH="0" MARGINHEIGHT="0"">
<span style="background-color: rgb(255, 255, 255);"><img src="RakNet_Icon_Final-copy.jpg" alt="Jenkins Software" width="150" height="150"></span><BR>
<BR>

<table width="100%" border="0"><tr>
  <td bgcolor="#2c5d92" class="RakNetWhiteHeader">
<img src="spacer.gif" width="8" height="1">Fully Connected 2 Mesh Plugin</td>
</tr></table>
<TABLE BORDER="0" CELLPADDING="10" CELLSPACING="0" WIDTH="100%"><TR>
  <TD><p><span class="RakNetBlueHeader">Automatically generate a fully connected mesh, while automatically choosing a host based on the longest running system.</span><BR>
        </p>
      FullyConnectedMesh2 has two operations:
      <ol>
      <li>When the message ID_REMOTE_NEW_INCOMING_CONNECTION arrives, connect to that system.</li>
      <li>Among all systems we are connected to, determine which system has been running the longest, and elect that system as the host.If uncertain, a system is chosen at random among systems that have been running a similar amount of time.</li>
    </ol>
    <p>The first operation can be enabled or disabled through FullyConnectedMesh2::SetConnectOnNewRemoteConnection(). Note that ID_REMOTE_NEW_INCOMING_CONNECTION is generated by the ConnectionGraph2 plugin, so you must also use the ConnectionGraph2 plugin for this operation to work. If this is disabled, you can connect manually through RakPeer::Connect().</p>
<p>The second operation chooses a host among all 'participants.' Generally, the participants are all systems you are connected to, but this does not have to be the case. You can automatically set connections to be participants with FullyConnectedMesh2::SetAutoparticipateConnections(), which is true by default. You can manually add participants with FullyConnectedMesh2::AddParticipant().</p>
    <p>The host is defined as the peer that has generally been running the longest, among all participants that it is connected to. Host determination takes about as long as it takes to do a ping, so is therefore nearly immediate. All peers agree on the same host. And when the current host disconnects, a new host is automatically and immediatelywith no network communiation needed.</p>
    <p>To get the current host, call FullyConnectedMesh2::GetConnectedHost(), FullyConnectedMesh2::GetConnectedHostAddr, or FullyConnectedMesh2::GetHostSystem(). The difference between a connected host and not is that if you are not connected to any participants, you are the host in the unconnected version. Otherwise, UNASSIGNED_RAKNET_GUID is returned.</p>
    <p><span class="RakNetBlueHeader">What is the use of knowing the host?</span>    </p>
    <p>In a peer to peer game, some events or data cannot be resolved locally because two peers may disagree. For example:</p>
    <ol>
      <li>Which objects exist in the level</li>
      <li>AI decisions</li>
      <li>Time level in the level</li>
      <li>Resolution when data between two hosts conflicts</li>
    </ol>
    <p>In that case it's useful to have one peer (the host) resolve or control this and send the outcome to all the other peers. While it's easy to do with a server, it's more difficult than it first looks to elect a common host that all peers agree on.</p>
    <p><span class="RakNetBlueHeader">How do I know when the host changes?</span></p>
    <p>You can poll for the current host with GetConnectedHost(). Or you can check for a network message which is locally generated and returned, ID_FCM2_NEW_HOST. The systemAddress parameter in the Packet structure will contain the address of the host. The guid parameter in the Packet structure will similarly contain the RakNetGUID of the host.</p>
<p>See <em>Samples/FCMHost</em> for a demonstration of this plugin</p></TD>
</TR></TABLE>

<table width="100%" border="0"><tr><td bgcolor="#2c5d92" class="RakNetWhiteHeader">
<img src="spacer.gif" width="8" height="1">See Also</td>
</tr></table>
<TABLE BORDER="0" CELLPADDING="10" CELLSPACING="0" WIDTH="100%"><TR><TD>

  <p><A HREF="index.html">Index</A><BR>
      <A HREF="plugininterface.html">PluginInterface</A><br>
      <a href="natpunchthrough.html">NAT-Punchthrough</a><br>
      <a href="readyevent.html">Ready Event</a><BR>
  </p>
  </TD></TR></TABLE>
</BODY>
</HTML>
