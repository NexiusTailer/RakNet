<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>RakNet: AutopatcherPostgreRepository Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>AutopatcherPostgreRepository Class Reference</h1><!-- doxytag: class="AutopatcherPostgreRepository" --><!-- doxytag: inherits="AutopatcherRepositoryInterface,PostgreSQLInterface" --><code>#include &lt;AutopatcherPostgreRepository.h&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for AutopatcherPostgreRepository:</div>
<div class="dynsection">

<p><center><img src="classAutopatcherPostgreRepository.png" usemap="#AutopatcherPostgreRepository_map" border="0" alt=""></center>
<map name="AutopatcherPostgreRepository_map">
<area href="classAutopatcherRepositoryInterface.html" alt="AutopatcherRepositoryInterface" shape="rect" coords="0,0,191,24">
</map>
</div>

<p>
<a href="classAutopatcherPostgreRepository-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#46245206cb10bd4b3a8f54cea5a24e89">CreateAutopatcherTables</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#880c10a173964ee9b9950045ad87ff00">DestroyAutopatcherTables</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#9afe18f08f3e46cb603bac5fd2489724">AddApplication</a> (const char *applicationName, const char *userName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#cdefff7ee5abd9722b11257efaeef586">RemoveApplication</a> (const char *applicationName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#6569adf665540c062f614c5f92a1a7d9">UpdateApplicationFiles</a> (const char *applicationName, const char *applicationDirectory, const char *userName, <a class="el" href="classFileListProgress.html">FileListProgress</a> *cb)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#ec798e7c9b4923973c092fc7d5a7318e">GetChangelistSinceDate</a> (const char *applicationName, FileList *addedFiles, FileList *deletedFiles, const char *sinceDate, char currentDate[64])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#f1a629da2e3e9b4aa502fccdfa8a7b81">GetPatches</a> (const char *applicationName, FileList *input, FileList *patchList, char currentDate[64])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1c0f293be5c1d4e287474c06e691e271"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetLastError" ref="1c0f293be5c1d4e287474c06e691e271" args="(void) const " -->
virtual const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#1c0f293be5c1d4e287474c06e691e271">GetLastError</a> (void) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">If any of the above functions fail, the error string is stored internally. Call this to get it. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#ca0c02df363b74e69fef84decbed6bef">GetFilePart</a> (const char *filename, unsigned int startReadBytes, unsigned int numBytesToRead, void *preallocatedDestination, FileListNodeContext context)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
An implementation of the <a class="el" href="classAutopatcherRepositoryInterface.html" title="An interface used by AutopatcherServer to get the data necessary to run an autopatcher...">AutopatcherRepositoryInterface</a> to use PostgreSQL to store the relevant data <hr><h2>Member Function Documentation</h2>
<a class="anchor" name="9afe18f08f3e46cb603bac5fd2489724"></a><!-- doxytag: member="AutopatcherPostgreRepository::AddApplication" ref="9afe18f08f3e46cb603bac5fd2489724" args="(const char *applicationName, const char *userName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::AddApplication           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userName</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add an application for use by files. Call this second. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>userName</em>&nbsp;</td><td>Stored in the database, but otherwise unused. Useful to track who added this application. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="46245206cb10bd4b3a8f54cea5a24e89"></a><!-- doxytag: member="AutopatcherPostgreRepository::CreateAutopatcherTables" ref="46245206cb10bd4b3a8f54cea5a24e89" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::CreateAutopatcherTables           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create the tables used by the autopatcher, for all applications. Call this first. <dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="880c10a173964ee9b9950045ad87ff00"></a><!-- doxytag: member="AutopatcherPostgreRepository::DestroyAutopatcherTables" ref="880c10a173964ee9b9950045ad87ff00" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::DestroyAutopatcherTables           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Destroy the tables used by the autopatcher. Don't call this unless you don't want to use the autopatcher anymore, or are testing. <dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="ec798e7c9b4923973c092fc7d5a7318e"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetChangelistSinceDate" ref="ec798e7c9b4923973c092fc7d5a7318e" args="(const char *applicationName, FileList *addedFiles, FileList *deletedFiles, const char *sinceDate, char currentDate[64])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool AutopatcherPostgreRepository::GetChangelistSinceDate           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>addedFiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>deletedFiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sinceDate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>currentDate</em>[64]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get list of files added and deleted since a certain date. This is used by <a class="el" href="classAutopatcherServer.html" title="The server plugin for the autopatcher. Must be running for the client to get patches...">AutopatcherServer</a> and not usually explicitly called. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>addedFiles</em>&nbsp;</td><td>A list of the current versions of filenames with SHA1_LENGTH byte hashes as their data that were created after <em>sinceData</em> </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>deletedFiles</em>&nbsp;</td><td>A list of the current versions of filenames that were deleted after <em>sinceData</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>An</em>&nbsp;</td><td>input date, in the string format of a timestamp. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>currentDate</em>&nbsp;</td><td>The server date, in the string format of a timestamp. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

<p>Implements <a class="el" href="classAutopatcherRepositoryInterface.html#7fa11918319ca26fa8a30694efaa4fab">AutopatcherRepositoryInterface</a>.</p>

</div>
</div><p>
<a class="anchor" name="ca0c02df363b74e69fef84decbed6bef"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetFilePart" ref="ca0c02df363b74e69fef84decbed6bef" args="(const char *filename, unsigned int startReadBytes, unsigned int numBytesToRead, void *preallocatedDestination, FileListNodeContext context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual unsigned int AutopatcherPostgreRepository::GetFilePart           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>startReadBytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>numBytesToRead</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>preallocatedDestination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileListNodeContext&nbsp;</td>
          <td class="paramname"> <em>context</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read part of a file into <em>destination</em> Return the number of bytes written. Return 0 when file is done. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>filename</em>&nbsp;</td><td>Filename to read </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>startReadBytes</em>&nbsp;</td><td>What offset from the start of the file to read from </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>numBytesToRead</em>&nbsp;</td><td>How many bytes to read. This is also how many bytes have been allocated to preallocatedDestination </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>preallocatedDestination</em>&nbsp;</td><td>Write your data here </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes read, or 0 if none </dd></dl>

</div>
</div><p>
<a class="anchor" name="f1a629da2e3e9b4aa502fccdfa8a7b81"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetPatches" ref="f1a629da2e3e9b4aa502fccdfa8a7b81" args="(const char *applicationName, FileList *input, FileList *patchList, char currentDate[64])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool AutopatcherPostgreRepository::GetPatches           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>patchList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>currentDate</em>[64]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get patches (or files) for every file in input, assuming that input has a hash for each of those files. This is used by <a class="el" href="classAutopatcherServer.html" title="The server plugin for the autopatcher. Must be running for the client to get patches...">AutopatcherServer</a> and not usually explicitly called. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>input</em>&nbsp;</td><td>A list of files with hashes to get from the database. If this hash exists, a patch to the current version is returned if this file is not the current version. Otherwise the current version is returned. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>patchList</em>&nbsp;</td><td>A list of files with either the filedata or the patch. This is a subset of <em>input</em>. The context data for each file will be either PC_WRITE_FILE (to just write the file) or PC_HASH_WITH_PATCH (to patch). If PC_HASH_WITH_PATCH, then the file contains a SHA1_LENGTH byte patch followed by the hash. The datalength is patchlength + SHA1_LENGTH </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>currentDate</em>&nbsp;</td><td>The current server date, in whatever format your repository uses </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

<p>Implements <a class="el" href="classAutopatcherRepositoryInterface.html#9cd608586a4428de28ddb9fbaf58826d">AutopatcherRepositoryInterface</a>.</p>

</div>
</div><p>
<a class="anchor" name="cdefff7ee5abd9722b11257efaeef586"></a><!-- doxytag: member="AutopatcherPostgreRepository::RemoveApplication" ref="cdefff7ee5abd9722b11257efaeef586" args="(const char *applicationName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::RemoveApplication           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove an application and files used by that application. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="6569adf665540c062f614c5f92a1a7d9"></a><!-- doxytag: member="AutopatcherPostgreRepository::UpdateApplicationFiles" ref="6569adf665540c062f614c5f92a1a7d9" args="(const char *applicationName, const char *applicationDirectory, const char *userName, FileListProgress *cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::UpdateApplicationFiles           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationDirectory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classFileListProgress.html">FileListProgress</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update all the files for an application to match what is at the specified directory. Call this third. Be careful not to call this with the wrong directory. This is implemented in a Begin and Rollback block so you won't a messed up database from get partial updates. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationDirectory</em>&nbsp;</td><td>The base directory of your application. All files in this directory and subdirectories are added. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>userName</em>&nbsp;</td><td>Stored in the database, but otherwise unused. Useful to track who added this revision </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cb</em>&nbsp;</td><td>Callback to get progress updates. Pass 0 to not use. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>d:/RakNet-3.x/DependentExtensions/Autopatcher/AutopatcherPostgreRepository/<a class="el" href="AutopatcherPostgreRepository_8h.html">AutopatcherPostgreRepository.h</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Jul 22 08:28:34 2011 for RakNet by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7.1 </small></address>
</body>
</html>
