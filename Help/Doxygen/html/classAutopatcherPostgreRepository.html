<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RakNet: AutopatcherPostgreRepository Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>AutopatcherPostgreRepository Class Reference</h1><!-- doxytag: class="AutopatcherPostgreRepository" --><!-- doxytag: inherits="AutopatcherRepositoryInterface" --><code>#include &lt;AutopatcherPostgreRepository.h&gt;</code>
<p>
<p>Inheritance diagram for AutopatcherPostgreRepository:
<p><center><img src="classAutopatcherPostgreRepository.png" usemap="#AutopatcherPostgreRepository_map" border="0" alt=""></center>
<map name="AutopatcherPostgreRepository_map">
<area href="classAutopatcherRepositoryInterface.html" alt="AutopatcherRepositoryInterface" shape="rect" coords="0,0,191,24">
</map>
<a href="classAutopatcherPostgreRepository-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#46245206cb10bd4b3a8f54cea5a24e89">CreateAutopatcherTables</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#880c10a173964ee9b9950045ad87ff00">DestroyAutopatcherTables</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#9afe18f08f3e46cb603bac5fd2489724">AddApplication</a> (const char *applicationName, const char *userName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#cdefff7ee5abd9722b11257efaeef586">RemoveApplication</a> (const char *applicationName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#6569adf665540c062f614c5f92a1a7d9">UpdateApplicationFiles</a> (const char *applicationName, const char *applicationDirectory, const char *userName, <a class="el" href="classFileListProgress.html">FileListProgress</a> *cb)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#1200635dcdb63e838cd109c8cd46fe1d">GetChangelistSinceDate</a> (const char *applicationName, FileList *addedFiles, FileList *deletedFiles, const char *sinceDate, char currentDate[64])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#ad9766b45949dc3ffabc2f1fcbfb9489">GetPatches</a> (const char *applicationName, FileList *input, FileList *patchList, char currentDate[64])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="93bec774d19433a0f93ecd8fe27d12e5"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetLastError" ref="93bec774d19433a0f93ecd8fe27d12e5" args="(void) const " -->
virtual const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutopatcherPostgreRepository.html#93bec774d19433a0f93ecd8fe27d12e5">GetLastError</a> (void) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">If any of the above functions fail, the error string is stored internally. Call this to get it. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
An implementation of the <a class="el" href="classAutopatcherRepositoryInterface.html">AutopatcherRepositoryInterface</a> to use PostgreSQL to store the relevant data 
<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="46245206cb10bd4b3a8f54cea5a24e89"></a><!-- doxytag: member="AutopatcherPostgreRepository::CreateAutopatcherTables" ref="46245206cb10bd4b3a8f54cea5a24e89" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::CreateAutopatcherTables           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create the tables used by the autopatcher, for all applications. Call this first. <dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="880c10a173964ee9b9950045ad87ff00"></a><!-- doxytag: member="AutopatcherPostgreRepository::DestroyAutopatcherTables" ref="880c10a173964ee9b9950045ad87ff00" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::DestroyAutopatcherTables           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Destroy the tables used by the autopatcher. Don't call this unless you don't want to use the autopatcher anymore, or are testing. <dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="9afe18f08f3e46cb603bac5fd2489724"></a><!-- doxytag: member="AutopatcherPostgreRepository::AddApplication" ref="9afe18f08f3e46cb603bac5fd2489724" args="(const char *applicationName, const char *userName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::AddApplication           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userName</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add an application for use by files. Call this second. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>userName</em>&nbsp;</td><td>Stored in the database, but otherwise unused. Useful to track who added this application. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="cdefff7ee5abd9722b11257efaeef586"></a><!-- doxytag: member="AutopatcherPostgreRepository::RemoveApplication" ref="cdefff7ee5abd9722b11257efaeef586" args="(const char *applicationName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::RemoveApplication           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove an application and files used by that application. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="6569adf665540c062f614c5f92a1a7d9"></a><!-- doxytag: member="AutopatcherPostgreRepository::UpdateApplicationFiles" ref="6569adf665540c062f614c5f92a1a7d9" args="(const char *applicationName, const char *applicationDirectory, const char *userName, FileListProgress *cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::UpdateApplicationFiles           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationDirectory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classFileListProgress.html">FileListProgress</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update all the files for an application to match what is at the specified directory. Call this third. Be careful not to call this with the wrong directory. This is implemented in a Begin and Rollback block so you won't a messed up database from get partial updates. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationDirectory</em>&nbsp;</td><td>The base directory of your application. All files in this directory and subdirectories are added. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>userName</em>&nbsp;</td><td>Stored in the database, but otherwise unused. Useful to track who added this revision </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cb</em>&nbsp;</td><td>Callback to get progress updates. Pass 0 to not use. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

</div>
</div><p>
<a class="anchor" name="1200635dcdb63e838cd109c8cd46fe1d"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetChangelistSinceDate" ref="1200635dcdb63e838cd109c8cd46fe1d" args="(const char *applicationName, FileList *addedFiles, FileList *deletedFiles, const char *sinceDate, char currentDate[64])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::GetChangelistSinceDate           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>addedFiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>deletedFiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sinceDate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>currentDate</em>[64]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get list of files added and deleted since a certain date. This is used by AutopatcherServer and not usually explicitly called. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>addedFiles</em>&nbsp;</td><td>A list of the current versions of filenames with SHA1_LENGTH byte hashes as their data that were created after <em>sinceData</em> </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>deletedFiles</em>&nbsp;</td><td>A list of the current versions of filenames that were deleted after <em>sinceData</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>An</em>&nbsp;</td><td>input date, in the string format of a timestamp. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>currentDate</em>&nbsp;</td><td>The server date, in the string format of a timestamp. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

<p>
Implements <a class="el" href="classAutopatcherRepositoryInterface.html#7fa11918319ca26fa8a30694efaa4fab">AutopatcherRepositoryInterface</a>.
</div>
</div><p>
<a class="anchor" name="ad9766b45949dc3ffabc2f1fcbfb9489"></a><!-- doxytag: member="AutopatcherPostgreRepository::GetPatches" ref="ad9766b45949dc3ffabc2f1fcbfb9489" args="(const char *applicationName, FileList *input, FileList *patchList, char currentDate[64])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AutopatcherPostgreRepository::GetPatches           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>applicationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FileList *&nbsp;</td>
          <td class="paramname"> <em>patchList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>currentDate</em>[64]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get patches (or files) for every file in input, assuming that input has a hash for each of those files. This is used by AutopatcherServer and not usually explicitly called. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>applicationName</em>&nbsp;</td><td>A null terminated string previously passed to AddApplication </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>input</em>&nbsp;</td><td>A list of files with hashes to get from the database. If this hash exists, a patch to the current version is returned if this file is not the current version. Otherwise the current version is returned. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>patchList</em>&nbsp;</td><td>A list of files with either the filedata or the patch. This is a subset of <em>input</em>. The context data for each file will be either PC_WRITE_FILE (to just write the file) or PC_HASH_WITH_PATCH (to patch). If PC_HASH_WITH_PATCH, then the file contains a SHA1_LENGTH byte patch followed by the hash. The datalength is patchlength + SHA1_LENGTH </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>currentDate</em>&nbsp;</td><td>The current server date, in whatever format your repository uses </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True on success, false on failure. </dd></dl>

<p>
Implements <a class="el" href="classAutopatcherRepositoryInterface.html#9cd608586a4428de28ddb9fbaf58826d">AutopatcherRepositoryInterface</a>.
</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>C:/RakNet/DependentExtensions/AutopatcherPostgreRepository/<a class="el" href="AutopatcherPostgreRepository_8h.html">AutopatcherPostgreRepository.h</a><li>C:/RakNet/DependentExtensions/AutopatcherPostgreRepository/<a class="el" href="AutopatcherPostgreRepository_8cpp.html">AutopatcherPostgreRepository.cpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Sun Jul 27 15:10:17 2008 for RakNet by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
